var background=document.getElementById("background");
var ball=document.getElementById("ball");
var ctx1=background.getContext("2d");
var ctx2=ball.getContext("2d");
//画背景图
function drawbackground(){
	var img=new Image;
	img.src="img/2.png";
	img.onload=function(){
		ctx1.drawImage(img,0,2)
	}
}
drawbackground();
//画球
var ratehright=[229,226,228,223,240,225,236,246,239,236,240,238,236,240,239,236,250,246,249,246,247,248,246,249,246,247];
//球的参数
//wd---x轴起始位置
//ht---y轴起始位置
//cstart,ostart为球的渐变颜色
//nub为球的号码
//id为球的id为了判断弹出什么球

var basedata=[
	{
		"wd":"38",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"20",
		"id":"20"
	},
	{
		"wd":"46",
		"ht":"227",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"24",
		"id":"24"
	},
	{
		"wd":"82",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"19",
		"id":"19"
	},{
		"wd":"110",
		"ht":"229",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"12",
		"id":"12"
	}
	,{
		"wd":"146",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"4",
		"id":"4"
	},
	//篮球
	{
		"wd":"150",
		"ht":"225",
		"ostart":"#2E6CA0",
		"cstart":"#B7C1DB",
		"nub":"",
		"id":"26"
	},
	{
		"wd":"160",
		"ht":"228",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"3",
		"id":"3"
	}
	,{
		"wd":"192",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"7",
		"id":"7"
	},
	{
		"wd":"240",
		"ht":"225",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"15",
		"id":"15"
	},
	//2
	{
		"wd":"40",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"11",
		"id":"11"
	},
	{
		"wd":"46",
		"ht":"239",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"9",
		"id":"9"
		
	},
	{
		"wd":"82",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"2",
		"id":"2"
	},{
		"wd":"110",
		"ht":"238",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"22",
		"id":"22"
	}
	,{
		"wd":"146",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"13",
		"id":"13"
	},
	{
		"wd":"180",
		"ht":"240",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"8",
		"id":"8"
	}
	,{
		"wd":"212",
		"ht":"239",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"17",
		"id":"17"
	},
	{
		"wd":"236",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"16",
		"id":"16"
	},
	//3
	{
		"wd":"37",
		"ht":"250",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"21",
		"id":"21"
	},
	{
		"wd":"49",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"14",
		"id":"14"
		
	},{
		"wd":"66",
		"ht":"249",
		"cstart":"#FFC500",
		"ostart":"#FF9800",
		"nub":"",
		"id":"25"
	},{
		"wd":"85",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"6",
		"id":"6"
	},{
		"wd":"115",
		"ht":"249",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"5",
		"id":"5"
	}
	,{
		"wd":"154",
		"ht":"247",
	"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"10",
		"id":"10"
	},
	{
		"wd":"183",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"18",
		"id":"18"
	}
	,{
		"wd":"214",
		"ht":"247",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"23",
		"id":"23"
	},
	{
		"wd":"239",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"1",
		"id":"1"
	}
];
var outheight=304;
var numbers;
var inindex=1;
var o;
//弹出球的参数（默认 ）
var outdata=[{
	"wd":"56",
	"ht":outheight,
	"cstart":"#D7DBE6",
	"ostart":"#949A9F",
	"nub":""
}];
//弹出球时的动画（暂未实现）
function outanimate(){
	ctx2.clearRect(0,304,300,400);
	if(inindex==1){
		outheight=312;
	}else if(inindex==2){
		outheight=300;
	}else{
		//inindex为3时会停止跳动
		//最后一次绘制
		clearInterval(o)
		outdata.forEach(function(v,i){
			drawball(v,i)
		});
		//以下参数设置回默认值
		outheight=312;
		inindex=1;
		numbers=""
		clearInterval(o);
		outdata=[{
			"wd":"56",
			"ht":outheight,
			"cstart":"#D7DBE6",
			"ostart":"#949A9F",
			"nub":""
		}];
		
		basedata=[
	{
		"wd":"38",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"20",
		"id":"20"
	},
	{
		"wd":"46",
		"ht":"227",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"24",
		"id":"24"
	},
	{
		"wd":"82",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"19",
		"id":"19"
	},{
		"wd":"110",
		"ht":"229",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"12",
		"id":"12"
	}
	,{
		"wd":"146",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"4",
		"id":"4"
	},
	//篮球
	{
		"wd":"150",
		"ht":"225",
		"ostart":"#2E6CA0",
		"cstart":"#B7C1DB",
		"nub":"",
		"id":"26"
	},
	{
		"wd":"160",
		"ht":"228",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"3",
		"id":"3"
	}
	,{
		"wd":"192",
		"ht":"226",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"7",
		"id":"7"
	},
	{
		"wd":"240",
		"ht":"225",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"15",
		"id":"15"
	},
	//2
	{
		"wd":"40",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"11",
		"id":"11"
	},
	{
		"wd":"46",
		"ht":"239",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"9",
		"id":"9"
		
	},
	{
		"wd":"82",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"2",
		"id":"2"
	},{
		"wd":"110",
		"ht":"238",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"22",
		"id":"22"
	}
	,{
		"wd":"146",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"13",
		"id":"13"
	},
	{
		"wd":"180",
		"ht":"240",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"8",
		"id":"8"
	}
	,{
		"wd":"212",
		"ht":"239",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"17",
		"id":"17"
	},
	{
		"wd":"236",
		"ht":"236",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"16",
		"id":"16"
	},
	//3
	{
		"wd":"37",
		"ht":"250",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"21",
		"id":"21"
	},
	{
		"wd":"49",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"14",
		"id":"14"
		
	},{
		"wd":"66",
		"ht":"249",
		"cstart":"#FFC500",
		"ostart":"#FF9800",
		"nub":"",
		"id":"25"
	},{
		"wd":"85",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"6",
		"id":"6"
	},{
		"wd":"115",
		"ht":"249",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"5",
		"id":"5"
	}
	,{
		"wd":"154",
		"ht":"247",
	"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"10",
		"id":"10"
	},
	{
		"wd":"183",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"18",
		"id":"18"
	}
	,{
		"wd":"214",
		"ht":"247",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"23",
		"id":"23"
	},
	{
		"wd":"239",
		"ht":"246",
		"cstart":"#D7DBE6",
		"ostart":"#949A9F",
		"nub":"1",
		"id":"1"
	}
];
	
		return
	}
	inindex++;
	outdata.forEach(function(v,i){
		drawball(v,i);
	})
}
//初始化绘制26球
basedata.forEach(function(v,i){
	drawball(v,i)
})
//绘制26球函数
function drawball(v,i){	
	ctx2.save();
	ctx2.beginPath();
	ctx2.translate(v.wd,v.ht);
	ctx2.shadowColor="rgba(0,0,0,0.3";
	ctx2.shadowOffsetX=-4;
	ctx2.shadowOffsetY=5;
	ctx2.shadowBlur=15;
	ctx2.arc(0,0,18,0,Math.PI/180*360);
	ctx2.closePath();
	var gr = ctx2.createRadialGradient(-5,4,3,0,0,18);
    //添加颜色端点
    gr.addColorStop(0,v.cstart);
    gr.addColorStop(1,v.ostart);    
	ctx2.fillStyle = gr;
    ctx2.fill();
    drawtext(v,i)
}
//球上写文字
function drawtext(v,i){
	ctx2.beginPath();
	ctx2.font = "bold 16px Courier New";
	ctx2.fillStyle="#ffffff";
	ctx2.rotate(10*Math.PI/180)
	ctx2.fillText(v.nub,-6,7)
	ctx2.closePath();
	ctx2.restore()
}
//让球动起来
var n=(Math.random()+1)*100
var addy=true;
var addx=true;
//未停下来之前
var ymax=226;
var ymin=60;
var xmax=226;
var xmin=30;
function go(){	
	if(ymin>=236){
		clearInterval(t);	
		clearInterval(s);
		//删除id为numbers的数组元素
		basedata.forEach(function(w,e){
			if(w.id==numbers){	
				var del={
					"wd":w.wd,
					"ht":w.ht,
					"cstart":w.sctart,
					"ostart":w.ostart,
					"nub":w.nub,
					"id":w.id
				}
				basedata.splice(e,1)
			};
		})
		basedata.forEach(function(q,j){
			basedata[j].ht=ratehright[j]
		})		
		ctx2.clearRect(0,0,300,400);
		basedata.forEach(function(v,i){			
			drawball(v,i)
		})
		//随机出糗的编号	
		o=setInterval(outanimate,20)
		ymin=60;		
		return;
	}
	basedata.forEach(function(v,i){
		if(addy && (parseInt(basedata[i].ht)<=ymin)){			
			addy=false;
		}else if((!addy) && (parseInt(basedata[i].ht)>=ymax)){
			addy=true;		
		}
		if(addx && (parseInt(basedata[i].wd)<=xmin)){			
			addx=false;
		}else if((!addx) && (parseInt(basedata[i].wd)>=xmax)){
			addx=true;	
		}		
		if(addx){
			basedata[i].wd=parseInt(basedata[i].wd)-Math.random()*10;
		}else{
			basedata[i].wd=parseInt(basedata[i].wd)+Math.random()*10;
		}	
		if(addy){
			basedata[i].ht=parseInt(basedata[i].ht)-Math.random()*20;
		}else{
			basedata[i].ht=parseInt(basedata[i].ht)+Math.random()*20;
		}
	})
	ctx2.clearRect(0,0,300,400)
	basedata.forEach(function(v,i){
		drawball(v,i)
	})
}
//减慢求得弹高
var t,s,time=6;
//
var stopFlag=false;
function slow(){
	ymin=ymin+10;
	return ymax;
}

document.getElementById("go").onclick=function(){
	if(stopFlag){
		return;
	}else{
		t=setInterval(go,time);
	 	stopFlag=true;
	}
	
}
document.getElementById("stop").onclick=function(){
	if(stopFlag){
		s=setInterval(slow,100);
	//随机产生出球的编号
		numbers=Math.ceil(Math.random()*26);
		console.log(numbers)
	//	numbers=25
		if(numbers==25){
			outdata[0].cstart="#FFC500";
			outdata[0].ostart="#FF9800";
			outdata[0].nub=""
		}else if(numbers==26){
			outdata[0].cstart="#B7C1DB";
			outdata[0].ostart="#2E6CA0";
			outdata[0].nub=""
		}else{
			outdata[0].nub=numbers;
		}
		stopFlag=false;
	}else{
		return;
	}
	
}
